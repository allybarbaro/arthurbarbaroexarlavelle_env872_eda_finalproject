---
title: "Aileen_scratch_work"
author: "Aileen Lavelle"
date: "2023-04-18"
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse);library(lubridate);library(here);library(knitr); library(cowplot); library(readxl);library(shinydashboard);
library(shiny);library(leaflet);library(mapview); library(sf);library(paletteer)
here()
#setting my own theme
Aileentheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"),
        axis.ticks = element_line(color = "black"), 
        plot.background = element_rect(color= "white"))
```

## R Markdown


```{r Age & Sex Pivot Longer}
#Creating pivot longer table for age & sex
carteret.age.sex <- read_csv(here("./Data/Processed/Carteret.age.sex.csv"))

#Seperating number and percents
caretert.age.sex.percent <- carteret.age.sex[seq(2, nrow(carteret.age.sex), 2), ]
caretert.age.sex.number <- carteret.age.sex[seq(1, nrow(carteret.age.sex), 2), ]

colnames(carteret.age.sex)
#Removing Median Age column b/c it is blank
caretert.age.sex.percent <- caretert.age.sex.percent %>%
  select(-("Median age (years)"))
#pivoting so columns become rows
caretert.age.sex.percent.pivot <- caretert.age.sex.percent %>%
  pivot_longer(cols=c("Under 5 years","5 to 9 years","10 to 14 years","15 to 19 years","20 to 24 years","25 to 34 years","35 to 44 years","45 to 54 years","55 to 59 years","60 to 64 years","65 to 74 years","75 to 84 years", "85 years and over"),
               names_to='Age',
               values_to='Population') %>%
  pivot_longer(cols=c("Male", "Female"),
               names_to='Sex',
               values_to='Percent') 

write.csv(caretert.age.sex.percent.pivot,
          file =here("./Data/Processed/Caretert.age.sex.percent.pivot.csv"))

#pivoting so columns become rows
caretert.age.sex.number.pivot <- caretert.age.sex.number %>%
  pivot_longer(cols=c("Under 5 years","5 to 9 years","10 to 14 years","15 to 19 years","20 to 24 years","25 to 34 years","35 to 44 years","45 to 54 years","55 to 59 years","60 to 64 years","65 to 74 years","75 to 84 years", "85 years and over","Median age (years)"),
               names_to='Age',
               values_to='Population') %>%
  pivot_longer(cols=c("Male", "Female"),
               names_to='Sex',
               values_to='Number of Individuals') 

write.csv(caretert.age.sex.number.pivot,
          file = here("./Data/Processed/Caretert.age.sex.number.pivot.csv"))
```


```{r Education Pivot Longer}
#Creating pivot longer table for age & sex
carteret.education <- read_csv(here("./Data/Processed/carteret.education.csv"))
colnames(carteret.education) <- c('Data type','Census Tract','Pop. >=25 years','Less than high school graduate','High school graduate (or equivelent)','some college, associates degree','Bachelor degree or higher')
  
#Separating number and percents
caretert.education.percent.belowpoverty <- carteret.education[seq(3, nrow(carteret.education), 3), ]
caretert.education.totalestimate <- carteret.education[seq(1, nrow(carteret.education), 3), ]
caretert.education.belowpoverty <- carteret.education[seq(2, nrow(carteret.education), 3), ]
colnames(carteret.education)

caretert.education.percent.belowpoverty.pivot <- caretert.education.percent.belowpoverty %>%
  pivot_longer(cols=c('Pop. >=25 years','Less than high school graduate','High school graduate (or equivelent)','some college, associates degree','Bachelor degree or higher'),
               names_to='Education Attainment',
               values_to='Percent Below Poverty Line') 

caretert.education.totalestimate.pivot <- caretert.education.totalestimate %>%
  pivot_longer(cols=c('Pop. >=25 years','Less than high school graduate','High school graduate (or equivelent)','some college, associates degree','Bachelor degree or higher'),
               names_to='Education Attainment',
               values_to='Total Estimate') 

caretert.education.belowpoverty.pivot <- caretert.education.belowpoverty %>%
  pivot_longer(cols=c('Pop. >=25 years','Less than high school graduate','High school graduate (or equivelent)','some college, associates degree','Bachelor degree or higher'),
               names_to='Education Attainment',
               values_to='Total Below Poverty Line') 

write.csv(caretert.education.belowpoverty.pivot,
          file = here("./Data/Processed/caretert.education.belowpoverty.pivot.csv"))
write.csv(caretert.education.totalestimate.pivot,
          file = here("./Data/Processed/caretert.education.totalestimate.pivot.csv"))
write.csv(caretert.education.percent.belowpoverty.pivot,
          file = here("./Data/Processed/caretert.education.percent.belowpoverty.pivot.csv"))

```


```{r Employment Pivot Longer}
carteret.employment <- read_csv(here("./Data/Processed/Carteret.Employment.csv"))

#seperate number and percents
carteret.employment.percent.belowpoverty <- carteret.employment[seq(3, nrow(carteret.employment), 3), ]
carteret.employment.totalestimate <- carteret.employment[seq(1, nrow(carteret.employment), 3), ]
carteret.employment.belowpoverty <- carteret.employment[seq(2, nrow(carteret.employment), 3), ]
colnames(carteret.employment)

colnames(carteret.employment.percent.belowpoverty) <- c("Data Type","Census Tract","Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females")

#pivot longer
carteret.employment.percent.belowpoverty.pivot <- carteret.employment.percent.belowpoverty %>%
  pivot_longer(cols=c("Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females"),
               names_to='Category',
               values_to='Percent of Population') 

colnames(carteret.employment.totalestimate) <- c("Data Type","Census Tract","Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females")

carteret.employment.totalestimate.pivot <- carteret.employment.totalestimate %>%
  pivot_longer(cols=c("Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females"),
               names_to='Category',
               values_to='Population') 

colnames(carteret.employment.belowpoverty) <- c("Data Type","Census Tract","Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females")

carteret.employment.belowpoverty.pivot <- carteret.employment.belowpoverty %>%
  pivot_longer(cols=c("Civilian Labor Force 16 Years and Over","Employed","Male","Female","Unemployed","Unemployed Males","Unemployed Females"),
               names_to='Category',
               values_to='Population') 


write.csv(carteret.employment.percent.belowpoverty.pivot,
          file = here("./Data/Processed/carteret.employment.percent.belowpoverty.pivot.csv"))
write.csv(carteret.employment.totalestimate.pivot,
          file = here("./Data/Processed/carteret.employment.totalestimate.pivot.csv"))
write.csv(carteret.employment.belowpoverty.pivot,
          file = here("./Data/Processed/carteret.employment.belowpoverty.pivot.csv"))
```

```{r Poverty Pivot Longer, echo=FALSE}
carteret.poverty <- read_csv(here("./Data/Processed/Carteret.poverty.csv"))

#seperate number and percents
carteret.poverty.percent <- carteret.poverty[seq(3, nrow(carteret.poverty), 3), ]
carteret.poverty.totalestimate <- carteret.poverty[seq(1, nrow(carteret.poverty), 3), ]
carteret.belowpoverty <- carteret.poverty[seq(2, nrow(carteret.poverty), 3), ]
colnames(carteret.poverty)

#pivot longer
carteret.poverty.percent.pivot <- carteret.poverty.percent %>%
  mutate(across(c("Census Tract"), as.numeric)) %>%
  pivot_longer(cols=c("Population for Whom Poverty Status is Determined","Under 18 years","18 to 64 years","65 years and over"),
               names_to='Category',
               values_to='Percent of Population')

write.csv(carteret.poverty.percent.pivot,
          file = here("./Data/Processed/carteret.poverty.percent.pivot.csv"))

carteret.poverty.totalestimate.pivot <- carteret.poverty.totalestimate %>%
  pivot_longer(cols=c("Population for Whom Poverty Status is Determined","Under 18 years","18 to 64 years","65 years and over"),
               names_to='Category',
               values_to='Total Estimate of Population')

write.csv(carteret.poverty.totalestimate.pivot,
          file = here("./Data/Processed/carteret.poverty.totalestimate.pivot.csv"))

carteret.belowpoverty.pivot <- carteret.belowpoverty %>%
  pivot_longer(cols=c("Population for Whom Poverty Status is Determined","Under 18 years","18 to 64 years","65 years and over"),
               names_to='Category',
               values_to='Population Below Poverty Line')

write.csv(carteret.belowpoverty.pivot,
          file = here("./Data/Processed/carteret.belowpoverty.pivot.csv"))
```

```{r Carteret county with demographics, echo=FALSE}
carteret.race.number <- read_csv(here("./Data/Processed/carteret.race.number.csv"))
carteret.shape <- st_read(here('./Data/Processed/carteret_tracts.shp'))
shape.and.race <- merge(carteret.shape, carteret.race.number, by = "TRACTCE")

#mapview(shape.and.race, zcol = "White",
        #col.regions = c(paletteer_c("ggthemes::Sunset-Sunrise Diverging", 30)))
```


```{r Joining flooding data, race data, and shapefile}
#loading in required data
carteret.race.percent <- read.csv(here("./Data/Processed/carteret.race.percent.csv"))
carteret.flooding <- read_csv(here('./Data/Processed/Carteret_Flooding_Processed.csv'))
carteret.shape <- st_read(here('./Data/Processed/carteret_tracts.shp'))

#change column names for flooding so that "TRACTCE" is in common
colnames(carteret.flooding) <-(c("TRACTCE", "Frequency"))
carteret.flooding$TRACTCE <- as.character(carteret.flooding$TRACTCE)

#merging files
shape.flooding <- merge(carteret.flooding, carteret.shape)
flooding.race.shape <- merge(shape.flooding, carteret.race.percent)
colnames(flooding.race.shape)

#getting rid of % symbol
flooding.race.shape$White <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$White))
flooding.race.shape$Black.or.African.American <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$Black.or.African.American))
flooding.race.shape$American.Indian.and.Alaska.Native <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$American.Indian.and.Alaska.Native))
flooding.race.shape$Cherokee.Tribal.Grouping <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$Cherokee.Tribal.Grouping))
flooding.race.shape$Sioux.Tribal.Grouping <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$Sioux.Tribal.Grouping))
flooding.race.shape$Asian <- as.numeric(gsub("[\\%,]", "", flooding.race.shape$Asian))
#making spatial
st_write(flooding.race.shape, here("./Data/Processed/flooding.race.shp"))
flooding_merged <- st_read("./Data/Processed/flooding.race.shp")

mapview(flooding_merged)

summary(flooding_merged$Freqncy)

carteret.max.flooding2 <- flooding_merged %>%
  filter(TRACTCE == 970401|970402|970502|970504)


mapview(merged.race.flooding.shape.shp)

#determining max flooding: 3.687
#determining least flooding: 0.012
summary(merged.race.flooding.shape$Frequency)

#extracting max flooding tract
carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(c(8,9,12,14))

carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(TRACTCE =="970401","970402","970502","970504")

carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(max(Frequency))
```
---
title: "Maeve_Scratch_Work"
output: html_document
date: "2023-04-17"
---
```{r}
knitr::opts_chunk$set(echo = TRUE)

#Loaded packages
library(tidyverse);library(rvest); library(ggplot2); library(lubridate); library(here)
library(tidyverse)
library(dplyr)
library(lubridate)
library(here)
library(tidycensus)
library(sf)
library(rgdal)
library(mapview)
library(leaflet)
library(shiny)

#Checked working directory
here()
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:
```{r wrangling race data}
#read in race data
carteret.race <- read_csv(here("./Data/Processed/Carteret.race.csv"))

#separating race number and percent into two data frames
#race number
carteret.race.number <- carteret.race[seq(1, nrow(carteret.race), 2), ]

carteret.race.number <- carteret.race.number %>%
  select("Census Tract","White","Black or African American","American Indian and Alaska Native","Cherokee Tribal Grouping","Sioux Tribal Grouping","Asian")

colnames(carteret.race.number) <-(c("TRACTCE", "White","Black or African American","American Indian and Alaska Native","Cherokee Tribal Grouping","Sioux Tribal Grouping","Asian"))

carteret.race.number$TRACTCE <- as.character(carteret.race.number$TRACTCE)
 
write_csv(carteret.race.number, file = here("./Data/Processed/carteret.race.number.csv"))

#Race percent
carteret.race.percent <- carteret.race[seq(2, nrow(carteret.race), 2), ]
carteret.race.percent <- carteret.race.percent %>%
  select("Census Tract","White","Black or African American","American Indian and Alaska Native","Cherokee Tribal Grouping","Sioux Tribal Grouping","Asian")

colnames(carteret.race.percent) <-(c("TRACTCE", "White","Black or African American","American Indian and Alaska Native","Cherokee Tribal Grouping","Sioux Tribal Grouping","Asian"))

carteret.race.percent$TRACTCE <- as.character(carteret.race.percent$TRACTCE)

write_csv(carteret.race.percent, file = here("./Data/Processed/carteret.race.percent.csv"))

carteret.race.number<- read_csv(here("./Data/Processed/carteret.race.number.csv"))
carteret.race.percent <- read_csv(here("./Data/Processed/carteret.race.percent.csv"))
```

```{pivoting race data for bar graph for laura}
caretert.group <- carteret.race.number %>%
  pivot_longer(cols=c("White","Black or African American","American Indian and Alaska Native","Cherokee Tribal Grouping","Sioux Tribal Grouping","Asian",),
               names_to='Race',
               values_to='Population')

write_csv(caretert.group, file = here("./Data/Processed/write_csv(carteret.race.number.pivoted.csv"))

write_csv(caretert.group, file = here("./Data/Processed/carteret.race.number.pivoted.csv"))
```



```{r Joining flooding data, race data, and shapefile}
#loading in required data
carteret.race.percent <- read.csv("./Data/Processed/carteret.race.percent.csv")
carteret.flooding <- read_csv(here('./Data/Processed/Carteret_Flooding_Processed.csv'))
carteret.shape <- st_read(here('./Data/Processed/carteret_tracts.shp'))

#change column names for flooding so that "TRACTCE" is in common
colnames(carteret.flooding) <-(c("TRACTCE", "Frequency"))
carteret.flooding$TRACTCE <- as.character(carteret.flooding$TRACTCE)

#merging 3 data frames
listed_df = list(carteret.race.percent, carteret.flooding, carteret.shape)
Reduce(function(x, y) merge(x, y, all=FALSE), list_df)

list_df = list(carteret.race.percent, carteret.flooding, carteret.shape)
df2 <- list_df %>% 
  reduce(inner_join, by='TRACTCE')
df2

#making spatial
st_write(df2, here("./Data/Processed/merged.race.flooding.shape.shp"))
flooding_merged <- st_read("./Data/Processed/merged.race.flooding.shape.shp")

mapview(flooding_merged)

summary(flooding_merged$Freqncy)

carteret.max.flooding2 <- flooding_merged %>%
  filter(TRACTCE == 970401|970402|970502|970504)



merged.race.flooding.shape <- merge(carteret.race.percent, carteret.flooding, carteret.shape, by.x = "TRACTCE", all=FALSE)

merged.race.flooding.shape2 <- merge(merged.race.flooding.shape, carteret.shape)

              #merge(carteret.shape)



mapview(merged.race.flooding.shape.shp)

#determining max flooding: 3.687
#determining least flooding: 0.012
summary(merged.race.flooding.shape$Frequency)

#extracting max flooding tract
carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(c(8,9,12,14))

carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(TRACTCE =="970401","970402","970502","970504")

carteret.max.flooding <- merged.race.flooding.shape %>%
  filter(max(Frequency))






#visualize

mapview(carteret.shape, zcol = "TRACTCE")






#view
mapview(shape.and.race, zcol = "White")

#map of Carteret county
shape.and.race <- sf::read_sf(shape.and.race) %>%
  sf::st_transform('+proj=longlat +datum=WGS84')

leaflet() %>% 
  addTiles() %>% 
  addPolygons(data=shape.and.race)


ui <- fluidPage(mainPanel( 
  #this will create a space for us to display our map
  leafletOutput(outputId = "mymap") 
  ))

server <- function(input, output, session) {
#create the map
output$mymap <- renderLeaflet({
    leaflet() %>% 
      addTiles() %>% 
      addPolygons(data=shape.and.race, zcol = "White")
                 })
}
shinyApp(ui, server)

```


```{r}

```


